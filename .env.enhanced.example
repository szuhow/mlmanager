# Enhanced ML Manager Environment Configuration
# Copy this file to .env in the project root

# ==============================================
# Docker Configuration
# ==============================================
COMPOSE_PROJECT_NAME=enhanced-ml-manager
COMPOSE_FILE=docker-compose.enhanced.yml

# ==============================================
# Resource Limits (adjust based on your system)
# ==============================================
# Memory settings
DEFAULT_SHM_SIZE=4gb
MEMORY_LIMIT=16G
MEMORY_RESERVATION=4G

# CPU settings  
OMP_NUM_THREADS=2
MKL_NUM_THREADS=2
TORCH_NUM_THREADS=2
DEFAULT_NUM_WORKERS=2

# Training settings
DEFAULT_BATCH_SIZE=8
MAX_EPOCHS=200

# ==============================================
# Enhanced ML Manager Settings
# ==============================================
# Inference settings
MAX_INFERENCE_IMAGES=50
DEFAULT_THRESHOLD=0.6
DEFAULT_MIN_COMPONENT_SIZE=50
DEFAULT_MORPHOLOGY_KERNEL_SIZE=3
DEFAULT_CONFIDENCE_THRESHOLD=0.6

# Post-processing defaults
ENABLE_MORPHOLOGICAL_OPENING=true
ENABLE_MORPHOLOGICAL_CLOSING=true
ENABLE_ADAPTIVE_THRESHOLD=false

# Training enhancement settings
DEFAULT_LOSS_FUNCTION=combined_dice_focal
DEFAULT_DICE_WEIGHT=0.7
DEFAULT_FOCAL_ALPHA=0.25
DEFAULT_FOCAL_GAMMA=2.0
DEFAULT_WEIGHT_DECAY=0.0001
DEFAULT_DROPOUT_RATE=0.1

# Early stopping
DEFAULT_EARLY_STOPPING_PATIENCE=15
DEFAULT_EARLY_STOPPING_METRIC=val_dice_score

# ==============================================
# Celery Configuration  
# ==============================================
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0
CELERY_TASK_SOFT_TIME_LIMIT=7200  # 2 hours
CELERY_TASK_TIME_LIMIT=10800      # 3 hours
CELERY_RESULT_EXPIRES=86400       # 24 hours

# Worker concurrency settings
CELERY_TRAINING_CONCURRENCY=1     # Single training task at a time
CELERY_INFERENCE_CONCURRENCY=2    # Multiple inference tasks
CELERY_CONTROL_CONCURRENCY=1      # Control tasks

# ==============================================
# MLflow Configuration
# ==============================================
MLFLOW_TRACKING_URI=http://mlflow:5000
MLFLOW_ARTIFACT_ROOT=/app/data/mlflow
MLFLOW_BACKEND_STORE_URI=sqlite:////app/data/mlflow/mlflow.db

# ==============================================
# Django Configuration  
# ==============================================
DJANGO_SETTINGS_MODULE=core.config.settings.development
DEBUG=true
SECRET_KEY=your-secret-key-change-in-production
ALLOWED_HOSTS=localhost,127.0.0.1,0.0.0.0

# Database (SQLite by default, change for production)
DATABASE_URL=sqlite:///db.sqlite3

# ==============================================
# Logging Configuration
# ==============================================
LOG_LEVEL=INFO
DJANGO_LOG_LEVEL=INFO
CELERY_LOG_LEVEL=INFO
ML_MANAGER_LOG_LEVEL=INFO

# Enable/disable specific logging
DISABLE_HTTP_LOGGING=false
ENABLE_TRAINING_LOGS=true
ENABLE_INFERENCE_LOGS=true

# ==============================================
# Security Settings (for production)
# ==============================================
# SECURE_SSL_REDIRECT=true
# SECURE_HSTS_SECONDS=31536000
# SECURE_HSTS_INCLUDE_SUBDOMAINS=true
# SECURE_HSTS_PRELOAD=true
# SECURE_CONTENT_TYPE_NOSNIFF=true
# SECURE_BROWSER_XSS_FILTER=true
# X_FRAME_OPTIONS=DENY

# ==============================================
# File Upload Settings
# ==============================================
FILE_UPLOAD_MAX_MEMORY_SIZE=10485760    # 10MB
DATA_UPLOAD_MAX_MEMORY_SIZE=52428800    # 50MB
MAX_MODEL_SIZE=524288000                 # 500MB

# ==============================================
# GPU Configuration (uncomment if using GPU)
# ==============================================
# Enable GPU support
# NVIDIA_VISIBLE_DEVICES=all
# NVIDIA_DRIVER_CAPABILITIES=compute,utility

# ==============================================
# Development Settings
# ==============================================
ENVIRONMENT=development
PYTHONUNBUFFERED=1
DISABLE_COLLECTSTATIC=1

# Development ports (change if needed)
DJANGO_PORT=8000
MLFLOW_PORT=5000
REDIS_PORT=6379
FLOWER_PORT=5555

# ==============================================
# Backup and Cleanup Settings
# ==============================================
# Automatic cleanup intervals (in hours)
TEMP_FILE_CLEANUP_HOURS=24
OLD_MODEL_CLEANUP_DAYS=30
LOG_RETENTION_DAYS=7

# Backup settings
ENABLE_AUTO_BACKUP=false
BACKUP_INTERVAL_HOURS=24
MAX_BACKUP_COUNT=7
